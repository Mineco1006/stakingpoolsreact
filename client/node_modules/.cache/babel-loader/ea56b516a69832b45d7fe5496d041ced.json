{"ast":null,"code":"async function generateTx(to, data, value, from = null) {\n  if (from === null) {\n    from = this.address;\n  }\n\n  const transactionCountResp = await axios.post(\"/getTransactionCount\", {\n    address: from\n  });\n  const fromFullShardKey = \"0x\" + from.slice(-8);\n  let toRecipient;\n  let toFullShardKey;\n\n  if (to !== \"\") {\n    toRecipient = to.slice(0, 42);\n    toFullShardKey = \"0x\" + to.slice(42);\n  } else {\n    toRecipient = \"\";\n    toFullShardKey = fromFullShardKey;\n  }\n\n  const rawTx = {\n    nonce: transactionCountResp.data.transactionCount,\n    from: from.slice(0, 42),\n    to: toRecipient,\n    gasPrice: \"0x\" + 2 .toString(16),\n    gas: \"0x\" + 350000 .toString(16),\n    value: \"0x\" + value.toString(16),\n    data,\n    fromFullShardKey,\n    toFullShardKey,\n    networkId: `0x${1 .toString(16)}`,\n    gasTokenId: `0x${this.gasTokenId.toString(16)}`,\n    transferTokenId: `0x${this.transferTokenId.toString(16)}`\n  };\n}\n\nasync function signAndSendTx(rawTx) {\n  let txId = '';\n\n  try {\n    txId = await this.qPocketSignAndSendTx(rawTx);\n  } catch (error) {\n    console.log(\"error 404\");\n    return;\n  }\n\n  txId = txId;\n  const success = !!txId && !txId.startsWith('0x000000000000000000000000000000000000000');\n\n  if (success) {\n    //const url = (<a href=\"/tx/${txId}\">${txId}</a>);\n    console.log(`Successfully sent transaction ${txId}.`);\n  } else {\n    console.log(\"Sending transaction failed\", 7000);\n  }\n}\n\nfunction metaMaskSignTyped(tx) {\n  console.log(\"Awaiting MetaMask signature confirmation...\");\n  return new Promise(function (resolve, reject) {\n    const web3js = new Web3(web3.currentProvider);\n    var from = web3js.eth.accounts[0];\n    var params = [getTypedTx(tx), from];\n    var method = 'eth_signTypedData';\n    web3js.currentProvider.send({\n      method,\n      params,\n      from\n    }, function (err, result) {\n      if (result.error !== undefined) {\n        console.log(\"It looks you declined the transaction in MetaMask\");\n        console.log(result.error);\n      }\n\n      console.log(result.result);\n    });\n  }.bind(this));\n}\n\nfunction getDeviceType() {\n  var ua = navigator.userAgent,\n      isWindowsPhone = /(?:Windows Phone)/.test(ua),\n      isSymbian = /(?:SymbianOS)/.test(ua) || isWindowsPhone,\n      isAndroid = /(?:Android)/.test(ua),\n      isFireFox = /(?:Firefox)/.test(ua),\n      isChrome = /(?:Chrome|CriOS)/.test(ua),\n      isTablet = /(?:iPad|PlayBook)/.test(ua) || isAndroid && !/(?:Mobile)/.test(ua) || isFireFox && /(?:Tablet)/.test(ua),\n      isPhone = /(?:iPhone)/.test(ua) && !isTablet,\n      isPc = !isPhone && !isAndroid && !isSymbian;\n  return {\n    isPhone,\n    isPc\n  };\n}\n\nfunction getTypedTx(tx) {\n  var msgParams = [{\n    type: 'uint256',\n    name: 'nonce',\n    value: `0x${tx.nonce.toString('hex')}`\n  }, {\n    type: 'uint256',\n    name: 'gasPrice',\n    value: `0x${tx.gasPrice.toString('hex')}`\n  }, {\n    type: 'uint256',\n    name: 'gasLimit',\n    value: `0x${tx.gasLimit.toString('hex')}`\n  }, {\n    type: 'uint160',\n    name: 'to',\n    value: tx.to\n  }, {\n    type: 'uint256',\n    name: 'value',\n    value: `0x${tx.value.toString('hex')}`\n  }, {\n    type: 'bytes',\n    name: 'data',\n    value: `0x${tx.data.toString('hex')}`\n  }, {\n    type: 'uint256',\n    name: 'networkId',\n    value: \"0x1\"\n  }, {\n    type: 'uint32',\n    name: 'fromFullShardKey',\n    value: `0x${tx.fromFullShardKey.toString('hex')}`\n  }, {\n    type: 'uint32',\n    name: 'toFullShardKey',\n    value: `0x${tx.toFullShardKey.toString('hex')}`\n  }, {\n    type: 'uint64',\n    name: 'gasTokenId',\n    value: \"0x8bb0\"\n  }, {\n    type: 'uint64',\n    name: 'transferTokenId',\n    value: \"0x8bb0\"\n  }, {\n    type: 'string',\n    name: 'qkcDomain',\n    value: 'bottom-quark'\n  }];\n  return msgParams;\n}\n\nexport { metaMaskSignTyped, getTypedTx, getDeviceType };","map":{"version":3,"sources":["C:/Users/Nico/Documents/GitHub/quarkchainposwapp/app/src/functionCol/lib.js"],"names":["generateTx","to","data","value","from","address","transactionCountResp","axios","post","fromFullShardKey","slice","toRecipient","toFullShardKey","rawTx","nonce","transactionCount","gasPrice","toString","gas","networkId","gasTokenId","transferTokenId","signAndSendTx","txId","qPocketSignAndSendTx","error","console","log","success","startsWith","metaMaskSignTyped","tx","Promise","resolve","reject","web3js","Web3","web3","currentProvider","eth","accounts","params","getTypedTx","method","send","err","result","undefined","bind","getDeviceType","ua","navigator","userAgent","isWindowsPhone","test","isSymbian","isAndroid","isFireFox","isChrome","isTablet","isPhone","isPc","msgParams","type","name","gasLimit"],"mappings":"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","sourcesContent":["\r\n\r\nasync function generateTx(to, data, value, from = null) {\r\n    if (from === null) {\r\n      from = this.address;\r\n    }\r\n    const transactionCountResp = await axios.post(\r\n      \"/getTransactionCount\",\r\n      { address: from },\r\n    );\r\n    const fromFullShardKey = \"0x\" + from.slice(-8);\r\n    let toRecipient;\r\n    let toFullShardKey;\r\n    if (to !== \"\") {\r\n      toRecipient = to.slice(0, 42);\r\n      toFullShardKey = \"0x\" + to.slice(42);\r\n    } else {\r\n      toRecipient = \"\";\r\n      toFullShardKey = fromFullShardKey;\r\n    }\r\n    const rawTx = {\r\n      nonce: transactionCountResp.data.transactionCount,\r\n      from: from.slice(0, 42),\r\n      to: toRecipient,\r\n      gasPrice: \"0x\" + (2).toString(16),\r\n      gas: \"0x\" + (350000).toString(16),\r\n      value: \"0x\" + value.toString(16),\r\n      data,\r\n      fromFullShardKey,\r\n      toFullShardKey,\r\n      networkId: `0x${(1).toString(16)}`,\r\n      gasTokenId: `0x${this.gasTokenId.toString(16)}`,\r\n      transferTokenId: `0x${this.transferTokenId.toString(16)}`,\r\n    }\r\n\r\n}\r\n\r\nasync function signAndSendTx(rawTx){\r\n    let txId = '';\r\n    try {\r\n        txId = await this.qPocketSignAndSendTx(rawTx);\r\n    } catch (error) {\r\n        console.log(\"error 404\")\r\n        return;\r\n    }\r\n\r\n    txId = txId;\r\n\r\n    const success = !!txId && !txId.startsWith('0x000000000000000000000000000000000000000');\r\n    if (success) {\r\n        //const url = (<a href=\"/tx/${txId}\">${txId}</a>);\r\n        console.log(`Successfully sent transaction ${txId}.`);\r\n        \r\n    } else {\r\n        console.log(\"Sending transaction failed\", 7000);\r\n    }\r\n}\r\n\r\nfunction metaMaskSignTyped(tx) {\r\n    console.log(\"Awaiting MetaMask signature confirmation...\");\r\n    return new Promise(function(resolve,reject) {\r\n        const web3js = new Web3(web3.currentProvider);\r\n        var from = web3js.eth.accounts[0];\r\n        var params = [getTypedTx(tx), from];\r\n        var method = 'eth_signTypedData';\r\n\r\n        web3js.currentProvider.send({\r\n          method,\r\n          params,\r\n          from,\r\n        }, function (err, result) {\r\n          if(result.error !== undefined) {\r\n            console.log(\"It looks you declined the transaction in MetaMask\");\r\n            console.log(result.error);\r\n          }\r\n          console.log(result.result);\r\n        })\r\n    }.bind(this));\r\n  }\r\n\r\nfunction getDeviceType() {\r\n  var ua = navigator.userAgent,\r\n          isWindowsPhone = /(?:Windows Phone)/.test(ua),\r\n          isSymbian = /(?:SymbianOS)/.test(ua) || isWindowsPhone,\r\n          isAndroid = /(?:Android)/.test(ua),\r\n          isFireFox = /(?:Firefox)/.test(ua),\r\n          isChrome = /(?:Chrome|CriOS)/.test(ua),\r\n          isTablet = /(?:iPad|PlayBook)/.test(ua) || (isAndroid && !/(?:Mobile)/.test(ua)) || (isFireFox && /(?:Tablet)/.test(ua)),\r\n          isPhone = /(?:iPhone)/.test(ua) && !isTablet,\r\n          isPc = !isPhone && !isAndroid && !isSymbian;\r\n  return {\r\n    isPhone,\r\n    isPc\r\n  }\r\n}\r\n\r\nfunction getTypedTx(tx) {\r\n\r\n  var msgParams = [\r\n    {\r\n      type: 'uint256',\r\n      name: 'nonce',\r\n      value: `0x${tx.nonce.toString('hex')}`\r\n    },\r\n    {\r\n      type: 'uint256',\r\n      name: 'gasPrice',\r\n      value: `0x${tx.gasPrice.toString('hex')}`\r\n    },\r\n    {\r\n      type: 'uint256',\r\n      name: 'gasLimit',\r\n      value: `0x${tx.gasLimit.toString('hex')}`\r\n    },\r\n    {\r\n      type: 'uint160',\r\n      name: 'to',\r\n      value: tx.to\r\n    },\r\n    {\r\n      type: 'uint256',\r\n      name: 'value',\r\n      value: `0x${tx.value.toString('hex')}`\r\n    },\r\n    {\r\n      type: 'bytes',\r\n      name: 'data',\r\n      value: `0x${tx.data.toString('hex')}`\r\n    },\r\n    {\r\n      type: 'uint256',\r\n      name: 'networkId',\r\n      value: \"0x1\"\r\n    },\r\n    {\r\n      type: 'uint32',\r\n      name: 'fromFullShardKey',\r\n      value: `0x${tx.fromFullShardKey.toString('hex')}`\r\n    },\r\n    {\r\n      type: 'uint32',\r\n      name: 'toFullShardKey',\r\n      value: `0x${tx.toFullShardKey.toString('hex')}`\r\n    },\r\n    {\r\n      type: 'uint64',\r\n      name: 'gasTokenId',\r\n      value: \"0x8bb0\"\r\n    },\r\n    {\r\n      type: 'uint64',\r\n      name: 'transferTokenId',\r\n      value: \"0x8bb0\"\r\n    },\r\n    {\r\n      type: 'string',\r\n      name: 'qkcDomain',\r\n      value: 'bottom-quark'\r\n    }\r\n  ];\r\n  return msgParams;\r\n}\r\n\r\nexport {metaMaskSignTyped, getTypedTx, getDeviceType};"]},"metadata":{},"sourceType":"module"}