{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Nico\\\\Documents\\\\GitHub\\\\stakingpoolsreact\\\\client\\\\src\\\\components\\\\userInterface.js\";\nimport Web3 from 'web3';\nimport QuarkChain from 'quarkchain-web3';\nimport React from 'react';\nimport axios from 'axios';\nimport { ABIinterface, roiABIinterface, poolROIContractAddress, poolContractAddress, fullShardKey, jrpcUrl, standardShardKeys } from './config.js';\nimport { ToastContainer, toast } from 'react-toastify';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass PoolUserInterface extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      userAddress: '',\n      stake: ''\n    };\n  }\n\n  getUserStake() {\n    const poolContract = this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress);\n    let stake;\n    poolContract.getStakesWithRewards(this.state.userAddress, {\n      from: this.state.userAddress\n    }, function (err, res) {\n      stake = Number((res / 10 ** 18).toFixed(2)).toLocaleString() + \" QKC\";\n      this.setState({\n        stake: stake\n      });\n    }.bind(this));\n  }\n\n  componentDidMount(props) {\n    if (window.web3) {\n      this.props.web3.eth.getAccounts().then(function (accounts) {\n        this.setState({\n          userAddress: accounts[0]\n        });\n        this.getUserStake();\n      }.bind(this));\n    }\n  }\n\n  render() {\n    if (window.web3) {\n      return /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: [/*#__PURE__*/_jsxDEV(\"tr\", {\n          className: \"rowcolour1\",\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            children: \"Your Address\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 42,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            colSpan: \"2\",\n            children: this.state.userAddress + standardShardKeys[this.props.index]\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 45,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 41,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n          className: \"rowcolour2\",\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            children: [\"Your Chain \", this.props.index, \" Pool Stake\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 50,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            colSpan: \"2\",\n            children: this.state.stake\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 53,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 49,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 40,\n        columnNumber: 11\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: /*#__PURE__*/_jsxDEV(\"tr\", {\n          className: \"rowcolour1\",\n          children: /*#__PURE__*/_jsxDEV(\"td\", {\n            colSpan: \"2\",\n            children: \"Please enable your web3 wallet to check your stake\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 64,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 11\n      }, this);\n    }\n  }\n\n}\n\nclass PoolAllocateAndWithdraw extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      add: '',\n      withdraw: '',\n      userAddress: '',\n      poolContract: '',\n      userBalance: '',\n      userBalanceNum: '',\n      stake: ''\n    };\n  }\n\n  getUserStake() {\n    const poolContract = this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress);\n    let stake;\n    poolContract.getStakesWithRewards(this.state.userAddress, {\n      from: this.state.userAddress\n    }, function (err, res) {\n      stake = Number((res / 10 ** 18).toFixed(2)).toLocaleString() + \" QKC\";\n      this.setState({\n        stake: stake\n      });\n    }.bind(this));\n  }\n\n  componentDidMount(props) {\n    if (window.web3) {\n      this.props.web3.eth.getAccounts().then(function (accounts) {\n        this.setState({\n          userAddress: accounts[0]\n        });\n        this.props.web3.qkc.getBalance(this.state.userAddress + standardShardKeys[this.props.index], function (err, res) {\n          const result = Number((res / 10 ** 18).toFixed(2)).toLocaleString() + \" QKC\";\n          const resultNum = (res / 10 ** 18).toFixed(2);\n          this.setState({\n            userBalance: result,\n            userBalanceNum: resultNum\n          });\n        }.bind(this));\n      }.bind(this));\n      this.setState({\n        poolContract: this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress)\n      });\n      this.getUserStake();\n    }\n  }\n\n  addStakeTx() {\n    //called when \"Add Stake\" button is clicked\n    if (this.state.add > this.state.userBalanceNum) {\n      toast.warn(`Insufficent funds on chain ${this.props.index}`);\n      return;\n    }\n\n    const txParams = {\n      gasPrice: 2e9,\n      gas: 350000,\n      to: QuarkChain.getEthAddressFromQkcAddress(this.props.poolAddress),\n      value: this.state.add * 1e18,\n      fromFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\n      toFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\n      networkId: 1\n    };\n    this.props.web3.qkc.sendTransaction(txParams, function (err, res) {\n      if (res != \"0x000000000000000000000000000000000000000000000000000000000000000000000000\" && res != undefined && res != null) {\n        toast.success(({\n          closeToast\n        }) => /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Your \", /*#__PURE__*/_jsxDEV(\"a\", {\n            href: `https://mainnet.quarkchain.io/tx/${res}`,\n            target: \"_blank\",\n            children: \"transaction\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 53\n          }, this), \" was sent successfully\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 43\n        }, this));\n        this.props.web3.qkc.getBalance(this.props.poolAddress, function (err, res) {\n          axios.post(\"http://localhost:3001/api/newSnapshot\", {\n            chainId: this.props.index,\n            balance: res + this.state.add * 1e18\n          });\n        });\n      } else {\n        toast.warn(\"Seems that your transaction has been declined\");\n      }\n    });\n  }\n\n  withdrawStake() {\n    //called when \"Withdraw\" button is clicked\n    const txParams = {\n      gasPrice: 2e9,\n      gas: 350000,\n      fromFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\n      toFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\n      networkId: 1\n    };\n    const value = this.state.withdraw * 1e18;\n    this.state.poolContract.withdrawStakes(value, txParams, function (err, res) {\n      if (res != \"0x000000000000000000000000000000000000000000000000000000000000000000000000\" && res != undefined && res != null) {\n        toast.success(({\n          closeToast\n        }) => /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [\"Your \", /*#__PURE__*/_jsxDEV(\"a\", {\n            href: `https://mainnet.quarkchain.io/tx/${res}`,\n            target: \"_blank\",\n            children: \"withdrawal\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 55\n          }, this), \" was sent successfully\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 45\n        }, this));\n        this.props.web3.qkc.getBalance(this.props.poolAddress, function (err, res) {\n          axios.post(\"http://localhost:3001/api/newSnapshot\", {\n            chainId: this.props.index,\n            balance: res - this.state.withdraw * 1e18\n          });\n        }.bind(this));\n      } else {\n        toast.warn(\"Seems that your transaction has been declined\");\n      }\n    }.bind(this));\n  }\n\n  handleAddChange(event) {\n    this.setState({\n      add: event.target.value\n    });\n  }\n\n  handleWithdrawChange(event) {\n    this.setState({\n      withdraw: event.target.value\n    });\n  }\n\n  render() {\n    if (window.ethereum) {\n      return /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: [/*#__PURE__*/_jsxDEV(\"tr\", {\n          className: \"rowcolour1\",\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            children: [\"Your Chain \", this.props.index, \" Balance\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            colSpan: \"2\",\n            children: this.state.userBalance\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n          className: \"rowcolour2\",\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            children: \"Deposit\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"inp\",\n              type: \"number\",\n              min: \"0\",\n              max: this.state.userBalance,\n              placeholder: \"e.g. 50000\",\n              value: this.state.add,\n              onChange: e => this.handleAddChange(e)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 189,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"but\",\n              onClick: this.addStakeTx.bind(this),\n              children: \"Deposit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n          className: \"rowcolour1\",\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            children: \"Withdraw\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              className: \"inp\",\n              type: \"number\",\n              min: \"0\",\n              max: this.state.stake,\n              placeholder: \"e.g. 50000\",\n              value: this.state.withdraw,\n              onChange: e => this.handleWithdrawChange(e)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"but\",\n              onClick: this.withdrawStake.bind(this),\n              children: \"Withdraw\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 11\n      }, this);\n    } else {\n      return null;\n    }\n  }\n\n}\n\nexport { PoolUserInterface, PoolAllocateAndWithdraw };","map":{"version":3,"sources":["C:/Users/Nico/Documents/GitHub/stakingpoolsreact/client/src/components/userInterface.js"],"names":["Web3","QuarkChain","React","axios","ABIinterface","roiABIinterface","poolROIContractAddress","poolContractAddress","fullShardKey","jrpcUrl","standardShardKeys","ToastContainer","toast","PoolUserInterface","Component","state","userAddress","stake","getUserStake","poolContract","props","web3","qkc","contract","at","poolAddress","getStakesWithRewards","from","err","res","Number","toFixed","toLocaleString","setState","bind","componentDidMount","window","eth","getAccounts","then","accounts","render","index","PoolAllocateAndWithdraw","add","withdraw","userBalance","userBalanceNum","getBalance","result","resultNum","addStakeTx","warn","txParams","gasPrice","gas","to","getEthAddressFromQkcAddress","value","fromFullShardKey","getFullShardKeyFromQkcAddress","toFullShardKey","networkId","sendTransaction","undefined","success","closeToast","post","chainId","balance","withdrawStake","withdrawStakes","handleAddChange","event","target","handleWithdrawChange","ethereum","e"],"mappings":"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","sourcesContent":["import Web3 from 'web3';\r\nimport QuarkChain from 'quarkchain-web3';\r\nimport React from 'react';\r\nimport axios from 'axios';\r\nimport {ABIinterface, roiABIinterface, poolROIContractAddress, poolContractAddress, fullShardKey, jrpcUrl, standardShardKeys} from './config.js'\r\nimport {ToastContainer, toast} from 'react-toastify';\r\n\r\nclass PoolUserInterface extends React.Component {\r\n    //poolAddress, web3, index\r\n  \r\n    state={\r\n      userAddress: '',\r\n      stake: ''\r\n    }\r\n  \r\n    getUserStake() {\r\n      const poolContract = this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress);\r\n      let stake\r\n    \r\n      poolContract.getStakesWithRewards(this.state.userAddress, {from: this.state.userAddress}, function(err, res){\r\n        stake = Number((res/10**18).toFixed(2)).toLocaleString() + \" QKC\"\r\n        this.setState({stake: stake})\r\n      }.bind(this));\r\n    }\r\n  \r\n    componentDidMount(props) {\r\n      if(window.web3) {\r\n        this.props.web3.eth.getAccounts().then(function(accounts) {\r\n        this.setState({userAddress: accounts[0]})\r\n        this.getUserStake()\r\n      }.bind(this))\r\n  \r\n      \r\n      }\r\n    }\r\n  \r\n    render() {\r\n      if(window.web3){\r\n        return (\r\n          <tbody>\r\n            <tr className=\"rowcolour1\">\r\n              <td>\r\n                Your Address\r\n              </td>\r\n              <td colSpan=\"2\">\r\n                {this.state.userAddress + standardShardKeys[this.props.index]}\r\n              </td>\r\n            </tr>\r\n            <tr className=\"rowcolour2\">\r\n              <td>\r\n                Your Chain {this.props.index} Pool Stake\r\n              </td>\r\n              <td colSpan=\"2\">\r\n                {this.state.stake}\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n          \r\n      )\r\n      }else{\r\n        return (\r\n          <tbody>\r\n            <tr className=\"rowcolour1\">\r\n              <td colSpan=\"2\">\r\n                Please enable your web3 wallet to check your stake\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        )\r\n      }\r\n      \r\n    }\r\n  }\r\n  \r\n  \r\n  \r\n  class PoolAllocateAndWithdraw extends React.Component {\r\n    //poolAddress, web3, index\r\n  \r\n    state = {\r\n      add: '',\r\n      withdraw: '',\r\n\r\n      userAddress: '',\r\n      poolContract: '',\r\n      userBalance: '',\r\n      userBalanceNum: '',\r\n      stake: ''\r\n    }\r\n\r\n    getUserStake() {\r\n      const poolContract = this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress);\r\n      let stake\r\n    \r\n      poolContract.getStakesWithRewards(this.state.userAddress, {from: this.state.userAddress}, function(err, res){\r\n        stake = Number((res/10**18).toFixed(2)).toLocaleString() + \" QKC\"\r\n        this.setState({stake: stake})\r\n      }.bind(this));\r\n    }\r\n  \r\n    componentDidMount(props) {\r\n      if(window.web3) {\r\n        this.props.web3.eth.getAccounts().then(function(accounts) {\r\n        this.setState({userAddress: accounts[0]});\r\n        this.props.web3.qkc.getBalance(this.state.userAddress + standardShardKeys[this.props.index], function(err, res){\r\n          const result = Number((res/10**18).toFixed(2)).toLocaleString() + \" QKC\";\r\n          const resultNum = (res/10**18).toFixed(2)\r\n          this.setState({userBalance: result, userBalanceNum: resultNum})\r\n        }.bind(this));\r\n      }.bind(this));\r\n      this.setState({poolContract: this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress)})\r\n      this.getUserStake()\r\n      }\r\n    }\r\n  \r\n    addStakeTx() { //called when \"Add Stake\" button is clicked\r\n\r\n      if(this.state.add > this.state.userBalanceNum) {\r\n        toast.warn(`Insufficent funds on chain ${this.props.index}`)\r\n        return\r\n      }\r\n  \r\n      const txParams = {\r\n        gasPrice: 2e9,\r\n        gas: 350000,\r\n        to: QuarkChain.getEthAddressFromQkcAddress(this.props.poolAddress),\r\n        value: this.state.add*1e18,\r\n        fromFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n        toFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n        networkId: 1\r\n    }\r\n    this.props.web3.qkc.sendTransaction(txParams, function(err,res) {\r\n      if(res != \"0x000000000000000000000000000000000000000000000000000000000000000000000000\" && res != undefined && res != null) {\r\n        toast.success(({ closeToast }) => <div>Your <a href={`https://mainnet.quarkchain.io/tx/${res}`} target=\"_blank\">transaction</a> was sent successfully</div>)\r\n        this.props.web3.qkc.getBalance(this.props.poolAddress, function(err, res) {\r\n          axios.post(\"http://localhost:3001/api/newSnapshot\", {chainId: this.props.index, balance: (res+(this.state.add*1e18))})\r\n        });\r\n      } else {\r\n        toast.warn(\"Seems that your transaction has been declined\")\r\n      }\r\n      });\r\n         \r\n    }\r\n  \r\n  \r\n  \r\n    withdrawStake() { //called when \"Withdraw\" button is clicked\r\n  \r\n      const txParams = {\r\n        gasPrice: 2e9,\r\n        gas: 350000,\r\n        fromFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n        toFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n        networkId: 1\r\n      }\r\n\r\n      const value = this.state.withdraw*1e18\r\n      \r\n      this.state.poolContract.withdrawStakes(value, txParams, function(err, res) {\r\n        if(res != \"0x000000000000000000000000000000000000000000000000000000000000000000000000\" && res != undefined && res != null) {\r\n          toast.success(({ closeToast }) => <div>Your <a href={`https://mainnet.quarkchain.io/tx/${res}`} target=\"_blank\">withdrawal</a> was sent successfully</div>) \r\n          this.props.web3.qkc.getBalance(this.props.poolAddress, function(err, res) {\r\n            axios.post(\"http://localhost:3001/api/newSnapshot\", {chainId: this.props.index, balance: (res-(this.state.withdraw*1e18))})\r\n          }.bind(this));\r\n        } else {\r\n          toast.warn(\"Seems that your transaction has been declined\")\r\n        }\r\n      }.bind(this));\r\n    }\r\n  \r\n    handleAddChange(event) {\r\n      this.setState({add: event.target.value});\r\n    }\r\n    handleWithdrawChange(event) {\r\n      this.setState({withdraw: event.target.value});\r\n    }\r\n    \r\n    render() {\r\n      if(window.ethereum) {\r\n        return (\r\n          <tbody>\r\n              <tr className=\"rowcolour1\">\r\n                <td>Your Chain {this.props.index} Balance</td>\r\n                <td colSpan=\"2\">{this.state.userBalance}</td>\r\n              </tr>\r\n              <tr className=\"rowcolour2\">\r\n                <td>Deposit</td>\r\n                <td>\r\n                  <input className=\"inp\" type=\"number\" min=\"0\" max={this.state.userBalance} placeholder=\"e.g. 50000\" value={this.state.add} onChange={e => this.handleAddChange(e)} />\r\n                </td>\r\n                <td>\r\n                  <button className=\"but\" onClick={this.addStakeTx.bind(this)}>Deposit</button>\r\n                </td>\r\n              </tr>\r\n              <tr className=\"rowcolour1\">\r\n                <td>Withdraw</td>\r\n                <td>\r\n                  <input className=\"inp\" type=\"number\" min=\"0\" max={this.state.stake} placeholder=\"e.g. 50000\" value={this.state.withdraw} onChange={e => this.handleWithdrawChange(e)} />\r\n                </td>\r\n                <td>\r\n                  <button className=\"but\" onClick={this.withdrawStake.bind(this)}>Withdraw</button>\r\n                </td>\r\n              </tr>\r\n          </tbody>\r\n        )\r\n      } else {\r\n        return (\r\n          null\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\nexport {PoolUserInterface, PoolAllocateAndWithdraw};"]},"metadata":{},"sourceType":"module"}