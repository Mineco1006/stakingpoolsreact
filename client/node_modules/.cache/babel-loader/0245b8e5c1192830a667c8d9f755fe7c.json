{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Nico/Documents/GitHub/quarkchainposwapp/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _classCallCheck from\"C:/Users/Nico/Documents/GitHub/quarkchainposwapp/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/Nico/Documents/GitHub/quarkchainposwapp/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/Nico/Documents/GitHub/quarkchainposwapp/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/Nico/Documents/GitHub/quarkchainposwapp/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _asyncToGenerator from\"C:/Users/Nico/Documents/GitHub/quarkchainposwapp/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import Web3 from'web3';import QuarkChain from'quarkchain-web3';import React from'react';import axios from'axios';import{ABIinterface,roiABIinterface,poolROIContractAddress,poolContractAddress,fullShardKey,jrpcUrl,standardShardKeys}from'./config.js';import{metaMaskSignTyped,getDeviceType,sendRawTx}from'../functionCol/lib';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var web3=new Web3();QuarkChain.injectWeb3(web3,jrpcUrl);function getContractInformation(_x,_x2){return _getContractInformation.apply(this,arguments);}function _getContractInformation(){_getContractInformation=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(poolAddress,poolROIAddress){var roiContract,poolContract,minerFee,poolFee,v1,v2,v3,v4,v5,v6,v7;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:roiContract=web3.qkc.contract(roiABIinterface).at(poolROIAddress);poolContract=web3.qkc.contract(ABIinterface).at(poolAddress);web3.qkc.getBalance(poolAddress,function(err,res){v1=Number((res/Math.pow(10,18)).toFixed(2)).toLocaleString()+\" QKC\";});poolContract.minerFee.call(function(err,res){minerFee=res/10000;v2=res/100+\"%\";});poolContract.poolFee.call(function(err,res){poolFee=res/10000;v3=res/100+\"%\";});poolContract.minStake.call(function(err,res){v4=Number((res/Math.pow(10,18)).toFixed(2)).toLocaleString()+\" QKC\";});poolContract.isClosed.call(function(err,res){if(res==false){v5=\"Open\";}if(res==true){v5=\"Closed\";}});roiContract.calculateROI(1,{},function(err,res){var result=(res/Math.pow(10,16)*(1-(minerFee+poolFee))).toFixed(3);v6=result+\"% / \"+(result*12).toFixed(1)+\"%\";});return _context2.abrupt(\"return\",new Promise(function(resolve){setTimeout(function(){resolve({balance:v1,minerFee:v2,poolFee:v3,minStake:v4,status:v5,roi:v6,userStake:v7});},1000);}));case 9:case\"end\":return _context2.stop();}}},_callee2);}));return _getContractInformation.apply(this,arguments);}var PoolInterface=/*#__PURE__*/function(_React$Component){_inherits(PoolInterface,_React$Component);var _super=_createSuper(PoolInterface);function PoolInterface(){var _this;_classCallCheck(this,PoolInterface);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={balance:'',roi:'',minStake:'',poolStatus:''};return _this;}_createClass(PoolInterface,[{key:\"componentDidMount\",value:function componentDidMount(props){var _this2=this;getContractInformation(this.props.poolAddress,this.props.poolROIAddress).then(function(data){_this2.setState({balance:data.balance,roi:data.roi,minStake:data.minStake,poolStatus:data.status});});console.log(this.props);}},{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(\"table\",{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"th\",{colSpan:\"2\",children:/*#__PURE__*/_jsxs(\"a\",{href:\"https://mainnet.quarkchain.io/address/\"+this.props.poolAddress,target:\"_blank\",children:[\"Chain \",this.props.index,\" Pool\"]})})})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"Estimated ROI monthly/annual\"}),/*#__PURE__*/_jsx(\"td\",{children:this.state.roi})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"Total Stakes\"}),/*#__PURE__*/_jsx(\"td\",{children:this.state.balance})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"Minimum Stake\"}),/*#__PURE__*/_jsx(\"td\",{children:this.state.minStake})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"Pool Status\"}),/*#__PURE__*/_jsx(\"td\",{children:this.state.poolStatus})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"Miner\"}),/*#__PURE__*/_jsx(\"td\",{children:this.props.miner})]})]})]});}}]);return PoolInterface;}(React.Component);var poolUserInterface=/*#__PURE__*/function(_React$Component2){_inherits(poolUserInterface,_React$Component2);var _super2=_createSuper(poolUserInterface);function poolUserInterface(){_classCallCheck(this,poolUserInterface);return _super2.apply(this,arguments);}_createClass(poolUserInterface,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(\"a\",{});}}]);return poolUserInterface;}(React.Component);var PoolAllocateWithdraw=/*#__PURE__*/function(_React$Component3){_inherits(PoolAllocateWithdraw,_React$Component3);var _super3=_createSuper(PoolAllocateWithdraw);function PoolAllocateWithdraw(){var _this3;_classCallCheck(this,PoolAllocateWithdraw);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}_this3=_super3.call.apply(_super3,[this].concat(args));_this3.state={add:'',withdraw:'',userAddress:''};return _this3;}_createClass(PoolAllocateWithdraw,[{key:\"componentDidMount\",value:function componentDidMount(props){this.props.web3.eth.getAccounts().then(function(accounts){console.log(accounts);this.setState({userAddress:accounts[0]});}.bind(this));console.log(this.props.web3);console.log(this.state.userAddress);}},{key:\"addStakeTx\",value:function(){var _addStakeTx=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(value){var txParams,rawTx;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.props.web3.qkc.getTransactionCount(this.state.userAddress+standardShardKeys[this.props.index]);case 2:_context.t0=_context.sent;_context.t1=QuarkChain.getEthAddressFromQkcAddress(this.props.poolAddress);_context.t2=this.state.userAddress;_context.t3=value*1e18;_context.t4=QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress);_context.t5=QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress);txParams={nonce:_context.t0,gasPrice:2,gasLimit:350000,to:_context.t1,from:_context.t2,value:_context.t3,data:0,fromFullShardKey:_context.t4,toFullShardKey:_context.t5};_context.next=11;return metaMaskSignTyped(txParams,this.props.web3,this.state.userAddress);case 11:rawTx=_context.sent;sendRawTx(rawTx);console.log(this.state.userAddress);case 14:case\"end\":return _context.stop();}}},_callee,this);}));function addStakeTx(_x3){return _addStakeTx.apply(this,arguments);}return addStakeTx;}()},{key:\"withdrawStake\",value:function withdrawStake(){var rawTx={value:this.state.withdraw*Math.pow(10,18),fromFullShardKey:QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),toFullShardKey:QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),gas:350000,gasPrice:2};}},{key:\"test\",value:function test(){console.log(\"test\");}},{key:\"handleAddChange\",value:function handleAddChange(event){this.setState({add:event.target.value});}},{key:\"handleWithdrawChange\",value:function handleWithdrawChange(event){this.setState({withdraw:event.target.value});}},{key:\"render\",value:function render(){var _this4=this;if(window.ethereum){return/*#__PURE__*/_jsx(\"table\",{children:/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsx(\"tr\",{children:this.state.userAddress}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"Add Stake\"}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",value:this.state.add,onChange:function onChange(e){return _this4.handleAddChange(e);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(){return _this4.addStakeTx(_this4.state.add);},children:\"Add Stake\"})})]}),/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:\"Withdraw\"}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",value:this.state.withdraw,onChange:function onChange(e){return _this4.handleWithdrawChange(e);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return _this4.withdrawStake;},children:\"Submit Tx\"})})]})]})});}else{return/*#__PURE__*/_jsx(\"table\",{children:/*#__PURE__*/_jsx(\"tfoot\",{children:\"Please make sure that you have a web3 wallet installed in your browser\"})});}}}]);return PoolAllocateWithdraw;}(React.Component);export{PoolInterface,PoolAllocateWithdraw};","map":{"version":3,"sources":["C:/Users/Nico/Documents/GitHub/quarkchainposwapp/app/src/components/siteComponents.js"],"names":["Web3","QuarkChain","React","axios","ABIinterface","roiABIinterface","poolROIContractAddress","poolContractAddress","fullShardKey","jrpcUrl","standardShardKeys","metaMaskSignTyped","getDeviceType","sendRawTx","web3","injectWeb3","getContractInformation","poolAddress","poolROIAddress","roiContract","qkc","contract","at","poolContract","getBalance","err","res","v1","Number","toFixed","toLocaleString","minerFee","call","v2","poolFee","v3","minStake","v4","isClosed","v5","calculateROI","result","v6","Promise","resolve","setTimeout","balance","status","roi","userStake","v7","PoolInterface","state","poolStatus","props","then","data","setState","console","log","index","miner","Component","poolUserInterface","PoolAllocateWithdraw","add","withdraw","userAddress","eth","getAccounts","accounts","bind","value","getTransactionCount","getEthAddressFromQkcAddress","getFullShardKeyFromQkcAddress","txParams","nonce","gasPrice","gasLimit","to","from","fromFullShardKey","toFullShardKey","rawTx","gas","event","target","window","ethereum","e","handleAddChange","addStakeTx","handleWithdrawChange","withdrawStake"],"mappings":"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","sourcesContent":["import Web3 from 'web3';\r\nimport QuarkChain from 'quarkchain-web3';\r\nimport React from 'react';\r\nimport axios from 'axios';\r\nimport {ABIinterface, roiABIinterface, poolROIContractAddress, poolContractAddress, fullShardKey, jrpcUrl, standardShardKeys} from './config.js'\r\nimport {metaMaskSignTyped, getDeviceType, sendRawTx} from '../functionCol/lib'\r\n\r\nlet web3 = new Web3();\r\nQuarkChain.injectWeb3(web3, jrpcUrl)\r\n\r\nasync function getContractInformation(poolAddress, poolROIAddress) {\r\n  const roiContract = web3.qkc.contract(roiABIinterface).at(poolROIAddress);\r\n  const poolContract = web3.qkc.contract(ABIinterface).at(poolAddress);\r\n  let minerFee;\r\n  let poolFee;\r\n\r\n  let v1;\r\n  let v2;\r\n  let v3;\r\n  let v4;\r\n  let v5;\r\n  let v6;\r\n  let v7;\r\n\r\n  web3.qkc.getBalance(poolAddress, function(err, res) {\r\n    v1 = Number((res/10**18).toFixed(2)).toLocaleString() + \" QKC\";\r\n  });\r\n\r\n  poolContract.minerFee.call(function(err, res){\r\n    minerFee = res/10000\r\n    v2 = res/100+\"%\";\r\n  });\r\n  poolContract.poolFee.call(function(err, res){\r\n    poolFee = res/10000\r\n    v3 = res/100+\"%\";\r\n  });\r\n  poolContract.minStake.call(function(err, res){\r\n    v4 = Number((res/10**18).toFixed(2)).toLocaleString() + \" QKC\";\r\n  });\r\n\r\n  poolContract.isClosed.call(function(err, res){\r\n      if(res == false){\r\n        v5 = \"Open\";\r\n      }\r\n      if(res == true){  \r\n        v5 = \"Closed\";\r\n      }\r\n  });\r\n\r\n  roiContract.calculateROI(1, {}, function(err, res) {\r\n    let result = ((res/10**16)*(1-(minerFee + poolFee))).toFixed(3)\r\n    v6 = result + \"% / \" + (result*12).toFixed(1) + \"%\";\r\n  });\r\n\r\n  return new Promise((resolve) => {\r\n    setTimeout(() => {\r\n      resolve({\r\n        balance: v1,\r\n        minerFee: v2,\r\n        poolFee: v3,\r\n        minStake: v4,\r\n        status: v5,\r\n        roi: v6,\r\n        userStake: v7\r\n      })\r\n    }, 1000)\r\n  })\r\n}\r\n\r\nclass PoolInterface extends React.Component {\r\n  // poolAddress, poolROIAddress, index, miner, web3\r\n\r\n  state = {\r\n    balance : '',\r\n    roi : '',\r\n    minStake : '',\r\n    poolStatus : ''\r\n  }\r\n\r\n  componentDidMount(props) {\r\n    getContractInformation(this.props.poolAddress, this.props.poolROIAddress).then(data => {\r\n      this.setState({balance: data.balance, roi: data.roi, minStake: data.minStake, poolStatus: data.status});\r\n    });\r\n    console.log(this.props)\r\n  }\r\n\r\n  render() {\r\n    \r\n    return (\r\n      <table>\r\n        <thead>\r\n          <tr>\r\n                <th colSpan=\"2\">\r\n                  <a href={\"https://mainnet.quarkchain.io/address/\" + this.props.poolAddress} target=\"_blank\">Chain {this.props.index} Pool</a>\r\n                </th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr>\r\n                <td>Estimated ROI monthly/annual</td>\r\n                <td>{this.state.roi}</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Total Stakes</td>\r\n                <td>{this.state.balance}</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Minimum Stake</td>\r\n                <td>{this.state.minStake}</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Pool Status</td>\r\n                <td>{this.state.poolStatus}</td>\r\n            </tr>\r\n            <tr>\r\n              <td>Miner</td>\r\n              <td>{this.props.miner}</td>\r\n            </tr>\r\n        </tbody>\r\n      </table>\r\n    )\r\n  }\r\n}\r\n\r\nclass poolUserInterface extends React.Component {\r\n  render() {\r\n    return (\r\n      <a></a>\r\n    )\r\n  }\r\n}\r\n\r\n\r\n\r\nclass PoolAllocateWithdraw extends React.Component {\r\n  //poolAddress, web3, index\r\n\r\n  state = {\r\n    add: '',\r\n    withdraw: '',\r\n    userAddress: ''\r\n  }\r\n\r\n  componentDidMount(props) {\r\n    this.props.web3.eth.getAccounts().then(function(accounts) {\r\n      console.log(accounts)\r\n      this.setState({userAddress: accounts[0]})\r\n    }.bind(this))\r\n      \r\n    console.log(this.props.web3)\r\n    console.log(this.state.userAddress)\r\n  }\r\n\r\n  async addStakeTx(value) {\r\n\r\n    const txParams = {\r\n      nonce: await this.props.web3.qkc.getTransactionCount(this.state.userAddress + standardShardKeys[this.props.index]),\r\n      gasPrice: 2,\r\n      gasLimit: 350000,\r\n      to: QuarkChain.getEthAddressFromQkcAddress(this.props.poolAddress),  // recipient of to address\r\n      from: this.state.userAddress,\r\n      value: value*1e18,\r\n      data: 0,\r\n      fromFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n      toFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n  }\r\n\r\n  let rawTx = await metaMaskSignTyped(txParams, this.props.web3, this.state.userAddress);\r\n\r\n  sendRawTx(rawTx);\r\n\r\n  console.log(this.state.userAddress)\r\n  }\r\n\r\n\r\n\r\n  withdrawStake() {\r\n    let rawTx = {\r\n      value: this.state.withdraw*10**18,\r\n      fromFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n      toFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n      gas: 350000,\r\n      gasPrice: 2\r\n    }\r\n  }\r\n\r\n  test() {\r\n    console.log(\"test\")\r\n  }\r\n\r\n  handleAddChange(event) {\r\n    this.setState({add: event.target.value});\r\n  }\r\n  handleWithdrawChange(event) {\r\n    this.setState({withdraw: event.target.value});\r\n  }\r\n  \r\n  render() {\r\n    if(window.ethereum) {\r\n      return (\r\n        <table>\r\n          <tbody>\r\n            <tr>\r\n              {this.state.userAddress}\r\n            </tr>\r\n            <tr>\r\n              <td>Add Stake</td>\r\n              <td>\r\n                <input type=\"number\" min=\"0\" value={this.state.add} onChange={e => this.handleAddChange(e)} />\r\n              </td>\r\n              <td>\r\n                <button type=\"button\" onClick={() => this.addStakeTx(this.state.add)}>Add Stake</button>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td>Withdraw</td>\r\n              <td>\r\n                <input type=\"number\" min=\"0\" value={this.state.withdraw} onChange={e => this.handleWithdrawChange(e)} />\r\n              </td>\r\n              <td>\r\n                <button onClick={ () => this.withdrawStake}>Submit Tx</button>\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      )\r\n    } else {\r\n      return (\r\n        <table>\r\n          <tfoot>\r\n            Please make sure that you have a web3 wallet installed in your browser\r\n          </tfoot>\r\n        </table>\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nexport {PoolInterface, PoolAllocateWithdraw};"]},"metadata":{},"sourceType":"module"}