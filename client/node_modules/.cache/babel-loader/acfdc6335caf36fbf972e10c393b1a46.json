{"ast":null,"code":"import _classCallCheck from\"C:/Users/Nico/Documents/GitHub/stakingpoolsreact/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/Nico/Documents/GitHub/stakingpoolsreact/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/Nico/Documents/GitHub/stakingpoolsreact/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/Nico/Documents/GitHub/stakingpoolsreact/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import QuarkChain from'quarkchain-web3';import React from'react';import axios from'axios';import{ABIinterface,standardShardKeys}from'./config.js';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PoolUserInterface=/*#__PURE__*/function(_React$Component){_inherits(PoolUserInterface,_React$Component);var _super=_createSuper(PoolUserInterface);function PoolUserInterface(){var _this;_classCallCheck(this,PoolUserInterface);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={userAddress:'',stake:''};return _this;}_createClass(PoolUserInterface,[{key:\"getUserStake\",value:function getUserStake(){var poolContract=this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress);var stake;poolContract.getStakesWithRewards(this.state.userAddress,{from:this.state.userAddress},function(err,res){stake=Number((res/Math.pow(10,18)).toFixed(2)).toLocaleString()+\" QKC\";this.setState({stake:stake});}.bind(this));}},{key:\"componentDidMount\",value:function componentDidMount(props){if(window.web3){this.props.web3.eth.getAccounts().then(function(accounts){this.setState({userAddress:accounts[0]});this.getUserStake();}.bind(this));}}},{key:\"render\",value:function render(){if(window.web3){return/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{className:\"rowcolour1\",children:[/*#__PURE__*/_jsx(\"td\",{children:\"Your Address\"}),/*#__PURE__*/_jsx(\"td\",{colSpan:\"2\",children:this.state.userAddress+standardShardKeys[this.props.index]})]}),/*#__PURE__*/_jsxs(\"tr\",{className:\"rowcolour2\",children:[/*#__PURE__*/_jsxs(\"td\",{children:[\"Your Chain \",this.props.index,\" Pool Stake\"]}),/*#__PURE__*/_jsx(\"td\",{colSpan:\"2\",children:this.state.stake})]})]});}else{return/*#__PURE__*/_jsx(\"tbody\",{children:/*#__PURE__*/_jsx(\"tr\",{className:\"rowcolour1\",children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"2\",children:\"Please enable your web3 wallet to check your stake\"})})});}}}]);return PoolUserInterface;}(React.Component);var PoolAllocateAndWithdraw=/*#__PURE__*/function(_React$Component2){_inherits(PoolAllocateAndWithdraw,_React$Component2);var _super2=_createSuper(PoolAllocateAndWithdraw);function PoolAllocateAndWithdraw(){var _this2;_classCallCheck(this,PoolAllocateAndWithdraw);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}_this2=_super2.call.apply(_super2,[this].concat(args));_this2.state={add:'',withdraw:'',userAddress:'',poolContract:'',userBalance:'',userBalanceNum:'',stake:''};return _this2;}_createClass(PoolAllocateAndWithdraw,[{key:\"getUserStake\",value:function getUserStake(){var poolContract=this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress);var stake;poolContract.getStakesWithRewards(this.state.userAddress,{from:this.state.userAddress},function(err,res){stake=res/1e18;this.setState({stake:stake});}.bind(this));}},{key:\"componentDidMount\",value:function componentDidMount(props){if(window.web3){this.props.web3.eth.getAccounts().then(function(accounts){this.setState({userAddress:accounts[0]});this.props.web3.qkc.getBalance(this.state.userAddress+standardShardKeys[this.props.index],function(err,res){var result=Number((res/1e18).toFixed(2)).toLocaleString()+\" QKC\";var resultNum=res/1e18;this.setState({userBalance:result,userBalanceNum:resultNum});}.bind(this));}.bind(this));this.setState({poolContract:this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress)});this.getUserStake();}}},{key:\"addStakeTx\",value:function addStakeTx(){//called when \"Add Stake\" button is clicked\nif(this.state.add>this.state.userBalanceNum){toast.warn(\"Insufficent funds on chain \".concat(this.props.index));return;}var txParams={gasPrice:2e9,gas:350000,to:QuarkChain.getEthAddressFromQkcAddress(this.props.poolAddress),value:this.state.add*1e18,fromFullShardKey:QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),toFullShardKey:QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),networkId:1};this.props.web3.qkc.sendTransaction(txParams,function(err,res){if(res!=\"0x000000000000000000000000000000000000000000000000000000000000000000000000\"&&res!=undefined&&res!=null){toast.success(function(_ref){var closeToast=_ref.closeToast;return/*#__PURE__*/_jsxs(\"div\",{children:[\"Your \",/*#__PURE__*/_jsx(\"a\",{href:\"https://mainnet.quarkchain.io/tx/\".concat(res),target:\"_blank\",children:\"transaction\"}),\" was sent successfully\"]});});this.props.web3.qkc.getBalance(this.props.poolAddress,function(err,res){axios.post(\"http://localhost:3001/api/newSnapshot\",{chainId:this.props.index,balance:res+this.state.add*1e18});});}else{toast.warn(\"Seems that your transaction has been declined\");}});}},{key:\"withdrawStake\",value:function withdrawStake(){//called when \"Withdraw\" button is clicked\nif(this.state.withdraw>this.state.stake){toast.warn(\"Insufficent stake on chain \".concat(this.props.index,\" pool\"));return;}var txParams={gasPrice:2e9,gas:350000,fromFullShardKey:QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),toFullShardKey:QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),networkId:1};var value=this.state.withdraw*1e18;this.state.poolContract.withdrawStakes(value,txParams,function(err,res){if(res!=\"0x000000000000000000000000000000000000000000000000000000000000000000000000\"&&res!=undefined&&res!=null){toast.success(function(_ref2){var closeToast=_ref2.closeToast;return/*#__PURE__*/_jsxs(\"div\",{children:[\"Your \",/*#__PURE__*/_jsx(\"a\",{href:\"https://mainnet.quarkchain.io/tx/\".concat(res),target:\"_blank\",children:\"withdrawal\"}),\" was sent successfully\"]});});this.props.web3.qkc.getBalance(this.props.poolAddress,function(err,res){axios.post(\"http://localhost:3001/api/newSnapshot\",{chainId:this.props.index,balance:res-this.state.withdraw*1e18});}.bind(this));}else{toast.warn(\"Seems that your transaction has been declined\");}}.bind(this));}},{key:\"handleAddChange\",value:function handleAddChange(event){this.setState({add:event.target.value});}},{key:\"handleWithdrawChange\",value:function handleWithdrawChange(event){this.setState({withdraw:event.target.value});}},{key:\"render\",value:function render(){var _this3=this;if(window.ethereum){return/*#__PURE__*/_jsxs(\"tbody\",{children:[/*#__PURE__*/_jsxs(\"tr\",{className:\"rowcolour1\",children:[/*#__PURE__*/_jsxs(\"td\",{children:[\"Your Chain \",this.props.index,\" Balance\"]}),/*#__PURE__*/_jsx(\"td\",{colSpan:\"2\",children:this.state.userBalance})]}),/*#__PURE__*/_jsxs(\"tr\",{className:\"rowcolour2\",children:[/*#__PURE__*/_jsx(\"td\",{children:\"Deposit\"}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{className:\"inp\",type:\"number\",min:\"0\",max:this.state.userBalance,placeholder:\"e.g. 50000\",value:this.state.add,onChange:function onChange(e){return _this3.handleAddChange(e);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"but\",onClick:this.addStakeTx.bind(this),children:\"Deposit\"})})]}),/*#__PURE__*/_jsxs(\"tr\",{className:\"rowcolour1\",children:[/*#__PURE__*/_jsx(\"td\",{children:\"Withdraw\"}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{className:\"inp\",type:\"number\",min:\"0\",max:this.state.stake,placeholder:\"e.g. 50000\",value:this.state.withdraw,onChange:function onChange(e){return _this3.handleWithdrawChange(e);}})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"button\",{className:\"but\",onClick:this.withdrawStake.bind(this),children:\"Withdraw\"})})]})]});}else{return null;}}}]);return PoolAllocateAndWithdraw;}(React.Component);export{PoolUserInterface,PoolAllocateAndWithdraw};","map":{"version":3,"sources":["C:/Users/Nico/Documents/GitHub/stakingpoolsreact/client/src/components/userInterface.js"],"names":["QuarkChain","React","axios","ABIinterface","standardShardKeys","toast","PoolUserInterface","state","userAddress","stake","poolContract","props","web3","qkc","contract","at","poolAddress","getStakesWithRewards","from","err","res","Number","toFixed","toLocaleString","setState","bind","window","eth","getAccounts","then","accounts","getUserStake","index","Component","PoolAllocateAndWithdraw","add","withdraw","userBalance","userBalanceNum","getBalance","result","resultNum","warn","txParams","gasPrice","gas","to","getEthAddressFromQkcAddress","value","fromFullShardKey","getFullShardKeyFromQkcAddress","toFullShardKey","networkId","sendTransaction","undefined","success","closeToast","post","chainId","balance","withdrawStakes","event","target","ethereum","e","handleAddChange","addStakeTx","handleWithdrawChange","withdrawStake"],"mappings":"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","sourcesContent":["import QuarkChain from 'quarkchain-web3';\r\nimport React from 'react';\r\nimport axios from 'axios';\r\nimport {ABIinterface, standardShardKeys} from './config.js'\r\nimport {toast} from 'react-toastify';\r\n\r\nclass PoolUserInterface extends React.Component {\r\n    //poolAddress, web3, index\r\n  \r\n    state={\r\n      userAddress: '',\r\n      stake: ''\r\n    }\r\n  \r\n    getUserStake() {\r\n      const poolContract = this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress);\r\n      let stake\r\n    \r\n      poolContract.getStakesWithRewards(this.state.userAddress, {from: this.state.userAddress}, function(err, res){\r\n        stake = Number((res/10**18).toFixed(2)).toLocaleString() + \" QKC\"\r\n        this.setState({stake: stake})\r\n      }.bind(this));\r\n    }\r\n  \r\n    componentDidMount(props) {\r\n      if(window.web3) {\r\n        this.props.web3.eth.getAccounts().then(function(accounts) {\r\n        this.setState({userAddress: accounts[0]})\r\n        this.getUserStake()\r\n      }.bind(this))\r\n  \r\n      \r\n      }\r\n    }\r\n  \r\n    render() {\r\n      if(window.web3){\r\n        return (\r\n          <tbody>\r\n            <tr className=\"rowcolour1\">\r\n              <td>\r\n                Your Address\r\n              </td>\r\n              <td colSpan=\"2\">\r\n                {this.state.userAddress + standardShardKeys[this.props.index]}\r\n              </td>\r\n            </tr>\r\n            <tr className=\"rowcolour2\">\r\n              <td>\r\n                Your Chain {this.props.index} Pool Stake\r\n              </td>\r\n              <td colSpan=\"2\">\r\n                {this.state.stake}\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n          \r\n      )\r\n      }else{\r\n        return (\r\n          <tbody>\r\n            <tr className=\"rowcolour1\">\r\n              <td colSpan=\"2\">\r\n                Please enable your web3 wallet to check your stake\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        )\r\n      }\r\n      \r\n    }\r\n  }\r\n  \r\n  \r\n  \r\n  class PoolAllocateAndWithdraw extends React.Component {\r\n    //poolAddress, web3, index\r\n  \r\n    state = {\r\n      add: '',\r\n      withdraw: '',\r\n\r\n      userAddress: '',\r\n      poolContract: '',\r\n      userBalance: '',\r\n      userBalanceNum: '',\r\n      stake: ''\r\n    }\r\n\r\n    getUserStake() {\r\n      const poolContract = this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress);\r\n      let stake\r\n    \r\n      poolContract.getStakesWithRewards(this.state.userAddress, {from: this.state.userAddress}, function(err, res){\r\n        stake = res/1e18\r\n        this.setState({stake: stake})\r\n      }.bind(this));\r\n    }\r\n  \r\n    componentDidMount(props) {\r\n      if(window.web3) {\r\n        this.props.web3.eth.getAccounts().then(function(accounts) {\r\n        this.setState({userAddress: accounts[0]});\r\n        this.props.web3.qkc.getBalance(this.state.userAddress + standardShardKeys[this.props.index], function(err, res){\r\n          const result = Number((res/1e18).toFixed(2)).toLocaleString() + \" QKC\";\r\n          const resultNum = res/1e18\r\n          this.setState({userBalance: result, userBalanceNum: resultNum})\r\n        }.bind(this));\r\n      }.bind(this));\r\n      this.setState({poolContract: this.props.web3.qkc.contract(ABIinterface).at(this.props.poolAddress)})\r\n      this.getUserStake()\r\n      }\r\n    }\r\n  \r\n    addStakeTx() { //called when \"Add Stake\" button is clicked\r\n\r\n      if(this.state.add > this.state.userBalanceNum) {\r\n        toast.warn(`Insufficent funds on chain ${this.props.index}`)\r\n        return\r\n      }\r\n  \r\n      const txParams = {\r\n        gasPrice: 2e9,\r\n        gas: 350000,\r\n        to: QuarkChain.getEthAddressFromQkcAddress(this.props.poolAddress),\r\n        value: this.state.add*1e18,\r\n        fromFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n        toFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n        networkId: 1\r\n    }\r\n    this.props.web3.qkc.sendTransaction(txParams, function(err,res) {\r\n      if(res != \"0x000000000000000000000000000000000000000000000000000000000000000000000000\" && res != undefined && res != null) {\r\n        toast.success(({ closeToast }) => <div>Your <a href={`https://mainnet.quarkchain.io/tx/${res}`} target=\"_blank\">transaction</a> was sent successfully</div>)\r\n        this.props.web3.qkc.getBalance(this.props.poolAddress, function(err, res) {\r\n          axios.post(\"http://localhost:3001/api/newSnapshot\", {chainId: this.props.index, balance: (res+(this.state.add*1e18))})\r\n        });\r\n      } else {\r\n        toast.warn(\"Seems that your transaction has been declined\")\r\n      }\r\n      });\r\n         \r\n    }\r\n  \r\n  \r\n  \r\n    withdrawStake() { //called when \"Withdraw\" button is clicked\r\n\r\n      if(this.state.withdraw > this.state.stake) {\r\n        toast.warn(`Insufficent stake on chain ${this.props.index} pool`)\r\n        return\r\n      }\r\n  \r\n      const txParams = {\r\n        gasPrice: 2e9,\r\n        gas: 350000,\r\n        fromFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n        toFullShardKey: QuarkChain.getFullShardKeyFromQkcAddress(this.props.poolAddress),\r\n        networkId: 1\r\n      }\r\n\r\n      const value = this.state.withdraw*1e18\r\n      \r\n      this.state.poolContract.withdrawStakes(value, txParams, function(err, res) {\r\n        if(res != \"0x000000000000000000000000000000000000000000000000000000000000000000000000\" && res != undefined && res != null) {\r\n          toast.success(({ closeToast }) => <div>Your <a href={`https://mainnet.quarkchain.io/tx/${res}`} target=\"_blank\">withdrawal</a> was sent successfully</div>) \r\n          this.props.web3.qkc.getBalance(this.props.poolAddress, function(err, res) {\r\n            axios.post(\"http://localhost:3001/api/newSnapshot\", {chainId: this.props.index, balance: (res-(this.state.withdraw*1e18))})\r\n          }.bind(this));\r\n        } else {\r\n          toast.warn(\"Seems that your transaction has been declined\")\r\n        }\r\n      }.bind(this));\r\n    }\r\n  \r\n    handleAddChange(event) {\r\n      this.setState({add: event.target.value});\r\n    }\r\n    handleWithdrawChange(event) {\r\n      this.setState({withdraw: event.target.value});\r\n    }\r\n    \r\n    render() {\r\n      if(window.ethereum) {\r\n        return (\r\n          <tbody>\r\n              <tr className=\"rowcolour1\">\r\n                <td>Your Chain {this.props.index} Balance</td>\r\n                <td colSpan=\"2\">{this.state.userBalance}</td>\r\n              </tr>\r\n              <tr className=\"rowcolour2\">\r\n                <td>Deposit</td>\r\n                <td>\r\n                  <input className=\"inp\" type=\"number\" min=\"0\" max={this.state.userBalance} placeholder=\"e.g. 50000\" value={this.state.add} onChange={e => this.handleAddChange(e)} />\r\n                </td>\r\n                <td>\r\n                  <button className=\"but\" onClick={this.addStakeTx.bind(this)}>Deposit</button>\r\n                </td>\r\n              </tr>\r\n              <tr className=\"rowcolour1\">\r\n                <td>Withdraw</td>\r\n                <td>\r\n                  <input className=\"inp\" type=\"number\" min=\"0\" max={this.state.stake} placeholder=\"e.g. 50000\" value={this.state.withdraw} onChange={e => this.handleWithdrawChange(e)} />\r\n                </td>\r\n                <td>\r\n                  <button className=\"but\" onClick={this.withdrawStake.bind(this)}>Withdraw</button>\r\n                </td>\r\n              </tr>\r\n          </tbody>\r\n        )\r\n      } else {\r\n        return (\r\n          null\r\n        )\r\n      }\r\n    }\r\n  }\r\n\r\nexport {PoolUserInterface, PoolAllocateAndWithdraw};"]},"metadata":{},"sourceType":"module"}